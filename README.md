# kvstore


## Description

`kvstore` is key/value store based on `std.json`.

The basic structure was inspired by the *DUB package* `dddb`
(see [DUB package repository](https://code.dlang.org/packages/dddb)
and [GitHub project](https://github.com/cvsae/dddb)).

Data is hold in memory and can be serialized to disk as JSON. As there is no
memory management, i.e. caching, paging, etc., it can not be considered a
*database*. Therefore `kvstore` cannot handle large data sets.

*Keys* and *values* both must be of type `string`. `wstring`, `dstring`,
their respective plain `char[]` equivalents, as well as *C strings* are not
supported. However, an array of values can be store with a single key.

Data is serialized in JSON format. When deserializing a store from disk the file
is read in chunks of 4096 bytes. As the serialized data in JSON format does not
contain any newline symbols the store file only consists of a single line.
Reading such file line-wise would not be the best idea.

In addition to the standard `get`, `set`, `remove`, `clear` operations there are
a couple more interesting operations. Among those are `closest` and `swap`.

`closest` computes key in the store being most similar to the one passed to the
function. This may be useful if keys are dates, like UNIX timestamps or dates in
the form `yymmdd`, for instance. As a JSON object is basically a map, `kvstore`
itself can be used as map data structure. If the key for a value is computed
there may be inaccurate results of such computation.
Keys are compared using a function implemented in the library that works similar
to C's `strcmp`.

The `swap` operation swaps a key with its value, thus making the former value
the new key of that entry, and the former the value for the new key. The
operation is overloaded and can also be performed on the whole store.
For the "uniqueness requirement", major pitfalls and dangers of using this
operation, and possible solutions see the API documentation of the `swap`
function.


## Build, Test, Installation

For this project the recommended way of managing the build process is using
the `make` command, rather then `dub`. For convenience, a `dub.json` file is
also part of this repository, though.

The *Makefile* provides the following targets: `build`, `test`, `install`,
`uninstall`. Of course, `clean` and `pack` targets are also present.

* `build`
  - The `build` target produces a dynamic library `libkvstore.so`.
  - The code is compiled for a 64-bit architecture using the *Digital Mars*
    compiler `dmd`.
    architecture.
  - DDoc documentation is generated on the fly by `dmd`.
  - This library is optimized for speed and all symbols are stripped from the
    library using the command `strip`.
  - A header file (*D interface file*) is also generated.

* `test`
  - The `test` target produces an executable (`kvstore_test`) with debugging
    symbols from the library code by adding a default `main()` function
    declaration.
  - The contained *unit tests* are executed automatically when using the `test`
    target as `rdmd` is used as "compiler" command.

* `install`
  - The `install` target copies the generated library to `/usr/local/lib`.
  - In addition a symbolic link to the library is created in the same directory
    containing the current version of the library.
  - This target can safely be executed several times.

* `uninstall`
  - The `uninstall` target reverts the step done by the `install` target.
  - All files created by the `install` target are removed from `/usr/local/lib`.

* `clean`
  - The `clean` target removes all files generated by `build` and `test`.

* `pack`
  - The `pack` target bundles the files of this repository in an `.txz`-archive.


## Copyright

Copyright &copy; 2020 Daniel Haase

`kvstore` is licensed under **GNU Lesser General Public License**, version 3.


## License disclaimer

```
kvstore - JSON key/value store
Copyright (C) 2020 Daniel Haase

This file is part of kvstore.

kvstore is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option)
any later version.

kvstore is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
details.

You should have received a copy of the GNU Lesser General Public License
along with kvstore.
If not, see <https://www.gnu.org/licenses/lgpl-3.0.txt>.
```

&lt;[https://www.gnu.org/licenses/lgpl-3.0.txt](https://www.gnu.org/licenses/lgpl-3.0.txt)&gt;
